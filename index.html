<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ch·∫•m c√¥ng & t√≠nh l∆∞∆°ng</title>

<!-- ‚úÖ PWA + ICON -->
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Ch·∫•m c√¥ng">
<meta name="theme-color" content="#1877f2">

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
  background:#f0f2f5;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:520px;
  min-width:320px;
  margin:12px auto;
  background:#fff;
  border-radius:18px;
  box-shadow:0 15px 40px rgba(0,0,0,.2);
  overflow:hidden;
}
.header{
  background:linear-gradient(135deg,#1877f2,#4facfe);
  color:#fff;
  padding:12px 14px;
}
.header-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.app-title{font-size:18px;font-weight:600}
.app-time{font-size:16px;font-weight:600}
.app-date{font-size:13px;opacity:.9;margin-top:2px}
.section{
  background:#fafafa;
  border-radius:14px;
  padding:12px;
  margin:12px;
  border:1px solid #eee;
}
.section-title{
  font-weight:600;
  display:flex;
  justify-content:space-between;
  cursor:pointer;
}
input{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #ccc;
}
.actions{
  display:flex;
  gap:8px;
  margin-top:10px;
}
button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:14px;
  color:#fff;
  font-size:15px;
}
.workBtn{background:#2ecc71}
.offBtn{background:#3498db}
.collapse{max-height:0;overflow:hidden;transition:.35s}
.collapse.open{max-height:400px}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:6px;border-bottom:1px solid #eee;text-align:center}
th{background:#f1f3f5}
.work{background:#eafaf1}
.off{background:#fdecea}
.summary{
  background:#f0f7ff;
  border-radius:14px;
  padding:12px;
  margin:12px;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  font-size:13px;
  text-align:center;
}
.cal-head{font-weight:600}
.cal-day{padding:6px;border-radius:6px;background:#eee}
.cal-work{background:#2ecc71;color:#fff}
.cal-off{background:#f8d7da;color:#c0392b}
.cal-today{border:2px solid #1877f2}
.motivate{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.25);
  z-index:999;
}
.motivate-box{
  padding:24px;
  border-radius:18px;
  color:#fff;
  font-size:18px;
  animation:pop .3s ease;
}
.success{background:#2ecc71}
.offStyle{background:#3498db}
@keyframes pop{from{transform:scale(.7)}to{transform:scale(1)}}
.footer{
  display:flex;
  justify-content:center;
  padding:12px;
  border-top:1px solid #eee;
}
.author-link{
  display:flex;
  align-items:center;
  gap:8px;
  text-decoration:none;
  color:#333;
  font-size:13px;
}
.logo{
  width:30px;
  height:30px;
  background:#1877f2;
  color:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <div class="header-top">
    <span class="app-title">üìã Ch·∫•m c√¥ng</span>
    <span class="app-time" id="clock"></span>
  </div>
  <div class="app-date" id="today"></div>
</div>

<div class="section">
  <div class="section-title" onclick="toggleInfo()">
    üë§ Th√¥ng tin & üí∞ L∆∞∆°ng <span id="infoArrow">‚ñº</span>
  </div>
  <div id="infoBox" class="collapse">
    <input id="nameInput" placeholder="T√™n">
    <input id="jobInput" placeholder="C√¥ng vi·ªác">
    <input id="salaryDayInput" type="number" placeholder="L∆∞∆°ng / ng√†y">
    <input id="otRateInput" type="number" placeholder="TƒÉng ca / gi·ªù">
  </div>
</div>

<div class="section">
  <div class="section-title">üìù Ch·∫•m c√¥ng h√¥m nay</div>
  <input id="noteInput" placeholder="Ghi ch√∫ (vd: tƒÉng ca 2h)">
  <div class="actions">
    <button class="workBtn" onclick="markWork()">üíº ƒêi l√†m</button>
    <button class="offBtn" onclick="markOff()">üåø Ngh·ªâ</button>
  </div>
</div>

<div class="section">
  <div class="section-title">üìÖ L·ªãch th√°ng</div>
  <div id="calendar" class="calendar"></div>
</div>

<table>
<thead>
<tr><th>Ng√†y</th><th>Tr·∫°ng th√°i</th><th>Gi·ªù</th><th>Ghi ch√∫</th></tr>
</thead>
<tbody id="log"></tbody>
</table>

<div class="summary">
  <p>üë§ <b id="showName"></b> ‚Äì <span id="showJob"></span></p>
  <p>‚úÖ Ng√†y l√†m: <b id="workDays">0</b></p>
  <p>‚è± OT: <b id="otHours">0</b> gi·ªù</p>
  <p>üíµ L∆∞∆°ng: <b id="totalSalary">0</b> ƒë</p>
</div>

<div class="footer">
  <a href="https://www.facebook.com/nhatquang" target="_blank" class="author-link">
    <div class="logo">NQ</div>
    <span>Developed by <b>Nh·∫≠t Quang</b></span>
  </a>
</div>

</div>

<audio id="soundWork" src="https://assets.mixkit.co/active_storage/sfx/2062/2062-preview.mp3"></audio>
<audio id="soundOff" src="https://assets.mixkit.co/active_storage/sfx/2594/2594-preview.mp3"></audio>

<div class="motivate" id="motivate">
  <div id="motivateBox" class="motivate-box">
    <div id="motivateText"></div>
  </div>
</div>

<script>
let data=JSON.parse(localStorage.getItem("chamcong")||"{}");

/* RESET CU·ªêI TH√ÅNG */
(function(){
  const now=new Date();
  const m=now.getFullYear()+"-"+(now.getMonth()+1);
  if(localStorage.getItem("lastMonth")!==m){
    localStorage.removeItem("chamcong");
    localStorage.setItem("lastMonth",m);
    data={};
  }
})();

/* CLOCK */
function updateClock(){
  const n=new Date();
  today.innerText=n.toLocaleDateString("vi-VN",{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"});
  clock.innerText=n.toLocaleTimeString("vi-VN");
}
setInterval(updateClock,1000);updateClock();

/* INFO */
function toggleInfo(){
  infoBox.classList.toggle("open");
  infoArrow.innerText=infoBox.classList.contains("open")?"‚ñ≤":"‚ñº";
}
[nameInput,jobInput,salaryDayInput,otRateInput].forEach(i=>{
  i.value=localStorage.getItem(i.id)||"";
  i.oninput=()=>localStorage.setItem(i.id,i.value);
});

/* SOUND */
function playSound(t){
  const s=t==="work"?soundWork:soundOff;
  s.currentTime=0;s.play().catch(()=>{});
}

/* POPUP */
const workMsg=["L√†m t·ªët l·∫Øm üí™","Chi·∫øn th√¥i üî•","C·ªë l√™n üëè"];
const offMsg=["Ngh·ªâ ng∆°i nha üòå","Th∆∞ gi√£n ch√∫t üåø"];
function showMotivate(t){
  motivate.style.display="flex";
  motivateBox.className="motivate-box "+(t==="work"?"success":"offStyle");
  motivateText.innerText=(t==="work"?workMsg:offMsg)[Math.floor(Math.random()*2)];
  setTimeout(()=>motivate.style.display="none",2000);
}

/* CHECK IN */
function extractOT(n){const m=n.match(/(\d+(\.\d+)?)\s*h/i);return m?+m[1]:0}
function save(st){
  const d=new Date(),k=d.toLocaleDateString("vi-VN");
  data[k]={date:k,status:st,time:d.toLocaleTimeString("vi-VN"),note:noteInput.value};
  localStorage.setItem("chamcong",JSON.stringify(data));
  noteInput.value="";render();
}
function markWork(){save("ƒêi l√†m");playSound("work");showMotivate("work")}
function markOff(){save("Ngh·ªâ");playSound("off");showMotivate("off")}

/* RENDER */
function render(){
  log.innerHTML="";let w=0,ot=0;
  Object.values(data).forEach(r=>{
    log.innerHTML+=`<tr class="${r.status==="ƒêi l√†m"?"work":"off"}">
    <td>${r.date}</td><td>${r.status}</td><td>${r.time}</td><td>${r.note||""}</td></tr>`;
    if(r.status==="ƒêi l√†m"){w++;ot+=extractOT(r.note||"")}
  });
  workDays.innerText=w;otHours.innerText=ot;
  totalSalary.innerText=((w*(salaryDayInput.value||0))+(ot*(otRateInput.value||0))).toLocaleString("vi-VN");
  showName.innerText=nameInput.value;showJob.innerText=jobInput.value;
  renderCalendar();
}

/* CALENDAR */
function renderCalendar(){
  calendar.innerHTML="";
  const n=new Date(),y=n.getFullYear(),m=n.getMonth();
  const f=new Date(y,m,1).getDay(),d=new Date(y,m+1,0).getDate();
  ["CN","T2","T3","T4","T5","T6","T7"].forEach(h=>calendar.innerHTML+=`<div class="cal-head">${h}</div>`);
  for(let i=0;i<f;i++)calendar.innerHTML+="<div></div>";
  for(let i=1;i<=d;i++){
    const k=new Date(y,m,i).toLocaleDateString("vi-VN");
    let c="cal-day";
    if(data[k])c+=" "+(data[k].status==="ƒêi l√†m"?"cal-work":"cal-off");
    if(i===n.getDate())c+=" cal-today";
    calendar.innerHTML+=`<div class="${c}">${i}</div>`;
  }
}

/* NH·∫ÆC QU√äN CH·∫§M C√îNG */
const REMIND_HOUR=19, REMIND_MIN=0;
setInterval(()=>{
  const n=new Date();
  if(n.getHours()!==REMIND_HOUR||n.getMinutes()!==REMIND_MIN) return;
  const k=n.toLocaleDateString("vi-VN");
  if(data[k]) return;
  alert("‚è∞ B·∫°n ch∆∞a ch·∫•m c√¥ng h√¥m nay!");
  if(navigator.vibrate) navigator.vibrate([200,100,200]);
  soundOff.play().catch(()=>{});
},30000);

render();

/* PWA SERVICE WORKER */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js");
  });
}
</script>

</body>
</html>
